#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Ø£Ø¯Ø§Ø© ÙØ­Øµ Ù…ØªØ®ØµØµØ© Ù„Ø«ØºØ±Ø§Øª Zoom Meetings ÙˆZoom API
Zoom Vulnerability Scanner
"""

import requests
import json
import argparse
import re
import socket
from datetime import datetime
import urllib3
import concurrent.futures

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

class ZoomVulnerabilityScanner:
    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })
        self.vulnerabilities = []

    def banner(self):
        banner = """
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                    Zoom Vulnerability Scanner               â•‘
    â•‘               ÙØ­Øµ Ù…ØªØ®ØµØµ Ù„Ø«ØºØ±Ø§Øª Zoom Meetings               â•‘
    â•‘                                                              â•‘
    â•‘  Meeting ID â€¢ Zoom API â€¢ Web Client â€¢ Desktop Client       â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        """
        print(banner)

    def scan_meeting_ids(self, target_domain):
        """ÙØ­Øµ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Zoom Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©"""
        print("ğŸ” ÙØ­Øµ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Zoom...")
        
        # Ø£Ù†Ù…Ø§Ø· Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Zoom Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
        meeting_patterns = [
            f"https://zoom.us/j/{target_domain}",
            f"https://us02web.zoom.us/j/{target_domain}",
            f"https://us04web.zoom.us/j/{target_domain}",
            f"https://us05web.zoom.us/j/{target_domain}",
            f"https://us06web.zoom.us/j/{target_domain}",
            f"https://us07web.zoom.us/j/{target_domain}",
            f"https://us08web.zoom.us/j/{target_domain}",
            f"https://us09web.zoom.us/j/{target_domain}",
            f"https://us10web.zoom.us/j/{target_domain}",
            f"https://us11web.zoom.us/j/{target_domain}",
            f"https://zoom.us/wc/join/{target_domain}",
            f"https://zoom.us/s/{target_domain}",
            f"https://zoom.us/my/{target_domain}"
        ]
        
        exposed_meetings = []
        
        for url in meeting_patterns:
            try:
                response = self.session.get(url, timeout=10, verify=False)
                
                if response.status_code == 200:
                    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ø¬ØªÙ…Ø§Ø¹ ÙØ¹Ø§Ù„
                    meeting_indicators = [
                        'meeting has not started',
                        'join a meeting',
                        'waiting for host',
                        'enter your name',
                        'meeting password',
                        'zoom meeting'
                    ]
                    
                    page_content = response.text.lower()
                    if any(indicator in page_content for indicator in meeting_indicators):
                        exposed_meetings.append({
                            'url': url,
                            'status': 'active',
                            'response_size': len(response.content)
                        })
                        
                        self.vulnerabilities.append({
                            'platform': 'Zoom',
                            'vulnerability': 'Exposed Meeting',
                            'url': url,
                            'risk_level': 'HIGH',
                            'description': f'Ø§Ø¬ØªÙ…Ø§Ø¹ Zoom Ù…ÙƒØ´ÙˆÙ: {url}',
                            'details': {
                                'meeting_id': target_domain,
                                'status': 'active'
                            }
                        })
                        
            except Exception as e:
                continue
        
        return exposed_meetings

    def scan_zoom_api_leaks(self, target_domain):
        """ÙØ­Øµ ØªØ³Ø±Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Zoom API"""
        print("ğŸ” ÙØ­Øµ ØªØ³Ø±Ø¨ Zoom API...")
        
        api_endpoints = [
            'https://api.zoom.us/v2/users',
            'https://api.zoom.us/v2/meetings',
            'https://api.zoom.us/v2/webinars',
            'https://api.zoom.us/v2/accounts',
            'https://api.zoom.us/v2/report/users'
        ]
        
        # Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ø¯ÙˆÙ† Ù…ØµØ§Ø¯Ù‚Ø©
        for endpoint in api_endpoints:
            try:
                response = self.session.get(endpoint, timeout=10)
                
                if response.status_code != 401:  # Ù„ÙŠØ³ Ø®Ø·Ø£ Ù…ØµØ§Ø¯Ù‚Ø©
                    self.vulnerabilities.append({
                        'platform': 'Zoom',
                        'vulnerability': 'API Information Leak',
                        'url': endpoint,
                        'risk_level': 'MEDIUM',
                        'description': f'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª API Zoom Ù…ØªØ§Ø­Ø©: {endpoint}',
                        'details': {
                            'status_code': response.status_code,
                            'response_size': len(response.content)
                        }
                    })
                    
            except Exception as e:
                continue

    def scan_zoom_web_client(self, target_domain):
        """ÙØ­Øµ Ø¹Ù…ÙŠÙ„ Zoom Web"""
        print("ğŸ” ÙØ­Øµ Ø¹Ù…ÙŠÙ„ Zoom Web...")
        
        web_client_urls = [
            f"https://zoom.us/wc/{target_domain}/join",
            f"https://zoom.us/wc/{target_domain}/start",
            f"https://zoom.us/wc/{target_domain}/leave",
            f"https://us02web.zoom.us/wc/{target_domain}/join",
            f"https://us04web.zoom.us/wc/{target_domain}/join"
        ]
        
        for url in web_client_urls:
            try:
                response = self.session.get(url, timeout=10, verify=False)
                
                if response.status_code == 200:
                    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØºÙŠØ± Ø¢Ù…Ù†Ø©
                    security_indicators = [
                        'password not required',
                        'waiting room disabled',
                        'screen sharing enabled',
                        'recording enabled',
                        'chat enabled'
                    ]
                    
                    page_content = response.text.lower()
                    if any(indicator in page_content for indicator in security_indicators):
                        self.vulnerabilities.append({
                            'platform': 'Zoom',
                            'vulnerability': 'Insecure Web Client Settings',
                            'url': url,
                            'risk_level': 'MEDIUM',
                            'description': f'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØºÙŠØ± Ø¢Ù…Ù†Ø© ÙÙŠ Ø¹Ù…ÙŠÙ„ Zoom Web: {url}',
                            'details': {
                                'endpoint': url,
                                'security_issues': [ind for ind in security_indicators if ind in page_content]
                            }
                        })
                        
            except Exception as e:
                continue

    def scan_zoom_desktop_client(self, target_domain):
        """ÙØ­Øµ Ø¹Ù…ÙŠÙ„ Zoom Desktop"""
        print("ğŸ” ÙØ­Øµ Ø¹Ù…ÙŠÙ„ Zoom Desktop...")
        
        # Ù…Ù†Ø§ÙØ° Ø¹Ù…ÙŠÙ„ Zoom Desktop
        zoom_ports = [8801, 8802, 8803, 19421, 19423, 3090]
        
        for port in zoom_ports:
            try:
                sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                sock.settimeout(3)
                result = sock.connect_ex((target_domain, port))
                sock.close()
                
                if result == 0:
                    self.vulnerabilities.append({
                        'platform': 'Zoom',
                        'vulnerability': 'Desktop Client Port Open',
                        'port': port,
                        'risk_level': 'LOW',
                        'description': f'Ø¹Ù…ÙŠÙ„ Zoom Desktop Ù…ØªØ§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° {port}',
                        'details': {
                            'port': port,
                            'service': 'Zoom Desktop Client'
                        }
                    })
                    
            except Exception as e:
                continue

    def scan_zoom_subdomains(self, target_domain):
        """ÙØ­Øµ Ù†Ø·Ø§Ù‚Ø§Øª ÙØ±Ø¹ÙŠØ© Ù„Ù€ Zoom"""
        print("ğŸ” ÙØ­Øµ Ù†Ø·Ø§Ù‚Ø§Øª ÙØ±Ø¹ÙŠØ© Ù„Ù€ Zoom...")
        
        zoom_subdomains = [
            f"zoom.{target_domain}",
            f"meet.{target_domain}",
            f"join.{target_domain}",
            f"app.{target_domain}",
            f"api.{target_domain}",
            f"admin.{target_domain}",
            f"web.{target_domain}",
            f"us02.{target_domain}",
            f"us04.{target_domain}",
            f"us05.{target_domain}"
        ]
        
        for subdomain in zoom_subdomains:
            try:
                response = self.session.get(f"https://{subdomain}", timeout=10, verify=False)
                
                if response.status_code == 200:
                    self.vulnerabilities.append({
                        'platform': 'Zoom',
                        'vulnerability': 'Zoom Subdomain Exposed',
                        'subdomain': subdomain,
                        'risk_level': 'MEDIUM',
                        'description': f'Ù†Ø·Ø§Ù‚ ÙØ±Ø¹ÙŠ Ù„Ù€ Zoom Ù…ÙƒØ´ÙˆÙ: {subdomain}',
                        'details': {
                            'subdomain': subdomain,
                            'response_size': len(response.content)
                        }
                    })
                    
            except Exception as e:
                continue

    def scan_zoom_recordings(self, target_domain):
        """ÙØ­Øµ ØªØ³Ø¬ÙŠÙ„Ø§Øª Zoom Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©"""
        print("ğŸ” ÙØ­Øµ ØªØ³Ø¬ÙŠÙ„Ø§Øª Zoom...")
        
        recording_patterns = [
            f"https://{target_domain}.zoom.us/rec/share/",
            f"https://us02web.zoom.us/rec/share/{target_domain}",
            f"https://us04web.zoom.us/rec/share/{target_domain}",
            f"https://{target_domain}.zoom.us/rec/play/",
            f"https://{target_domain}.zoom.us/rec/download/"
        ]
        
        for url in recording_patterns:
            try:
                response = self.session.get(url, timeout=10, verify=False)
                
                if response.status_code == 200:
                    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª
                    recording_indicators = [
                        'recording',
                        'video',
                        'audio',
                        'mp4',
                        'download',
                        'share'
                    ]
                    
                    page_content = response.text.lower()
                    if any(indicator in page_content for indicator in recording_indicators):
                        self.vulnerabilities.append({
                            'platform': 'Zoom',
                            'vulnerability': 'Recording Exposure',
                            'url': url,
                            'risk_level': 'HIGH',
                            'description': f'ØªØ³Ø¬ÙŠÙ„ Zoom Ù…ÙƒØ´ÙˆÙ: {url}',
                            'details': {
                                'recording_url': url,
                                'accessible': True
                            }
                        })
                        
            except Exception as e:
                continue

    def scan_zoom_chat_leaks(self, target_domain):
        """ÙØ­Øµ ØªØ³Ø±Ø¨ Ø¯Ø±Ø¯Ø´Ø© Zoom"""
        print("ğŸ” ÙØ­Øµ ØªØ³Ø±Ø¨ Ø¯Ø±Ø¯Ø´Ø© Zoom...")
        
        chat_endpoints = [
            f"https://zoom.us/chat/{target_domain}",
            f"https://zoom.us/messages/{target_domain}",
            f"https://us02web.zoom.us/chat/{target_domain}"
        ]
        
        for url in chat_endpoints:
            try:
                response = self.session.get(url, timeout=10, verify=False)
                
                if response.status_code == 200:
                    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª
                    chat_indicators = [
                        'chat',
                        'message',
                        'conversation',
                        'private',
                        'group'
                    ]
                    
                    page_content = response.text.lower()
                    if any(indicator in page_content for indicator in chat_indicators):
                        self.vulnerabilities.append({
                            'platform': 'Zoom',
                            'vulnerability': 'Chat Data Exposure',
                            'url': url,
                            'risk_level': 'HIGH',
                            'description': f'Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø±Ø¯Ø´Ø© Zoom Ù…ÙƒØ´ÙˆÙØ©: {url}',
                            'details': {
                                'chat_endpoint': url,
                                'data_exposed': True
                            }
                        })
                        
            except Exception as e:
                continue

    def scan_zoom_security_settings(self, target_domain):
        """ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† ÙÙŠ Zoom"""
        print("ğŸ” ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†...")
        
        security_checks = [
            {
                'name': 'Waiting Room',
                'indicators': ['waiting room', 'waiting room enabled', 'waiting for host']
            },
            {
                'name': 'Password Protection',
                'indicators': ['password required', 'meeting password', 'passcode']
            },
            {
                'name': 'Screen Sharing',
                'indicators': ['screen sharing', 'share screen', 'present']
            },
            {
                'name': 'Recording',
                'indicators': ['recording', 'record meeting', 'auto recording']
            }
        ]
        
        base_urls = [
            f"https://zoom.us/j/{target_domain}",
            f"https://us02web.zoom.us/j/{target_domain}"
        ]
        
        for url in base_urls:
            try:
                response = self.session.get(url, timeout=10, verify=False)
                
                if response.status_code == 200:
                    page_content = response.text.lower()
                    
                    for check in security_checks:
                        if not any(indicator in page_content for indicator in check['indicators']):
                            self.vulnerabilities.append({
                                'platform': 'Zoom',
                                'vulnerability': f'Insecure {check["name"]}',
                                'url': url,
                                'risk_level': 'MEDIUM',
                                'description': f'Ø¥Ø¹Ø¯Ø§Ø¯ {check["name"]} ØºÙŠØ± Ø¢Ù…Ù†: {url}',
                                'details': {
                                    'setting': check['name'],
                                    'url': url
                                }
                            })
                            
            except Exception as e:
                continue

    def generate_report(self, target):
        """Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„"""
        print("\nğŸ“Š ØªÙ‚Ø±ÙŠØ± ÙØ­Øµ Zoom")
        print("=" * 60)
        
        if not self.vulnerabilities:
            print("âœ… Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø«ØºØ±Ø§Øª ÙÙŠ Zoom")
            return
        
        # ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø®Ø§Ø·Ø±
        high = [v for v in self.vulnerabilities if v['risk_level'] == 'HIGH']
        medium = [v for v in self.vulnerabilities if v['risk_level'] == 'MEDIUM']
        low = [v for v in self.vulnerabilities if v['risk_level'] == 'LOW']
        
        print(f"ğŸ”´ Ø«ØºØ±Ø§Øª Ø¹Ø§Ù„ÙŠØ©: {len(high)}")
        print(f"âš ï¸  Ø«ØºØ±Ø§Øª Ù…ØªÙˆØ³Ø·Ø©: {len(medium)}")
        print(f"â„¹ï¸  Ø«ØºØ±Ø§Øª Ù…Ù†Ø®ÙØ¶Ø©: {len(low)}")
        print()
        
        # Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        for vuln in self.vulnerabilities:
            print(f"[{vuln['risk_level']}] {vuln['vulnerability']}: {vuln['description']}")
            if 'url' in vuln:
                print(f"    URL: {vuln['url']}")
            print()
        
        # Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        report = {
            'target': target,
            'scan_date': datetime.now().isoformat(),
            'scan_type': 'Zoom Vulnerability Scan',
            'total_vulnerabilities': len(self.vulnerabilities),
            'high': len(high),
            'medium': len(medium),
            'low': len(low),
            'vulnerabilities': self.vulnerabilities
        }
        
        filename = f"zoom_vulnerabilities_{target}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(report, f, ensure_ascii=False, indent=2)
        
        print(f"ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ: {filename}")

    def run_zoom_scan(self, target):
        """ØªØ´ØºÙŠÙ„ ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù€ Zoom"""
        self.banner()
        
        print(f"ğŸ¯ Ø¨Ø¯Ø¡ ÙØ­Øµ Zoom: {target}")
        print("=" * 60)
        
        # ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙØ­Øµ
        scanners = [
            self.scan_meeting_ids,
            self.scan_zoom_api_leaks,
            self.scan_zoom_web_client,
            self.scan_zoom_desktop_client,
            self.scan_zoom_subdomains,
            self.scan_zoom_recordings,
            self.scan_zoom_chat_leaks,
            self.scan_zoom_security_settings
        ]
        
        for scanner in scanners:
            try:
                scanner(target)
            except Exception as e:
                print(f"âš ï¸ Ø®Ø·Ø£ ÙÙŠ {scanner.__name__}: {str(e)}")
        
        self.generate_report(target)
        return self.vulnerabilities

def main():
    parser = argparse.ArgumentParser(description='Ø£Ø¯Ø§Ø© ÙØ­Øµ Ù…ØªØ®ØµØµØ© Ù„Ø«ØºØ±Ø§Øª Zoom Meetings')
    parser.add_argument('-t', '--target', required=True, help='Ø§Ù„Ù‡Ø¯Ù Ù„Ù„ÙØ­Øµ (Meeting ID Ø£Ùˆ Ù†Ø·Ø§Ù‚)')
    parser.add_argument('-o', '--output', help='Ù…Ù„Ù Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ JSON')
    
    args = parser.parse_args()
    
    scanner = ZoomVulnerabilityScanner()
    vulnerabilities = scanner.run_zoom_scan(args.target)

if __name__ == "__main__":
    main()