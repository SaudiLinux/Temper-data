#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Ø£Ø¯Ø§Ø© ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù†ØµØ§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ù‡ÙŠØ±Ø©
Platform Vulnerability Scanner for Zoom, Microsoft Exchange, Cloud Servers, and Frameworks
"""

import requests
import socket
import ssl
import json
import argparse
import urllib3
from datetime import datetime
import dns.resolver
import concurrent.futures
import re
import time

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

class PlatformVulnerabilityScanner:
    def __init__(self):
        self.vulnerabilities = []
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })

    def banner(self):
        banner = """
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                    Platform Vulnerability Scanner          â•‘
    â•‘               ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù†ØµØ§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ù‡ÙŠØ±Ø©      â•‘
    â•‘                                                              â•‘
    â•‘  Zoom â€¢ Microsoft Exchange â€¢ Cloud Servers â€¢ Frameworks   â•‘
    â•‘  ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø«ØºØ±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù†ØµØ§Øª Ø§Ù„Ù…Ù†ØªØ´Ø±Ø©              â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        """
        print(banner)

    def scan_zoom_vulnerabilities(self, target):
        """ÙØ­Øµ Ø«ØºØ±Ø§Øª Zoom Meetings"""
        print("ğŸ” ÙØ­Øµ Ø«ØºØ±Ø§Øª Zoom...")
        zoom_issues = []
        
        # ÙØ­Øµ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Zoom Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©
        zoom_patterns = [
            f"https://zoom.us/j/{target}",
            f"https://us02web.zoom.us/j/{target}",
            f"https://us04web.zoom.us/j/{target}",
            f"https://us05web.zoom.us/j/{target}",
            f"https://us06web.zoom.us/j/{target}",
            f"https://us07web.zoom.us/j/{target}",
            f"https://zoom.us/wc/join/{target}"
        ]
        
        for url in zoom_patterns:
            try:
                response = self.session.get(url, timeout=10, verify=False)
                if response.status_code == 200:
                    if "meeting" in response.text.lower() or "zoom" in response.text.lower():
                        zoom_issues.append({
                            'platform': 'Zoom',
                            'vulnerability': 'Exposed Meeting',
                            'url': url,
                            'risk_level': 'HIGH',
                            'description': f'Ø§Ø¬ØªÙ…Ø§Ø¹ Zoom Ù…ÙƒØ´ÙˆÙ: {url}'
                        })
            except:
                pass
        
        # ÙØ­Øµ ØªØ³Ø±Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Zoom
        try:
            api_url = f"https://api.zoom.us/v2/meetings/{target}"
            response = self.session.get(api_url, timeout=10)
            if response.status_code != 404:
                zoom_issues.append({
                    'platform': 'Zoom',
                    'vulnerability': 'API Information Leak',
                    'url': api_url,
                    'risk_level': 'MEDIUM',
                    'description': 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª API Zoom Ù…ØªØ§Ø­Ø©'
                })
        except:
            pass
            
        return zoom_issues

    def scan_exchange_vulnerabilities(self, target):
        """ÙØ­Øµ Ø«ØºØ±Ø§Øª Microsoft Exchange Server"""
        print("ğŸ” ÙØ­Øµ Ø«ØºØ±Ø§Øª Microsoft Exchange...")
        exchange_issues = []
        
        # ÙØ­Øµ OWA (Outlook Web Access)
        owa_urls = [
            f"https://{target}/owa",
            f"https://{target}/exchange",
            f"https://{target}/ecp",
            f"https://mail.{target}/owa",
            f"https://webmail.{target}/owa",
            f"https://{target}/Microsoft-Server-ActiveSync"
        ]
        
        for url in owa_urls:
            try:
                response = self.session.get(url, timeout=15, verify=False)
                if response.status_code == 200:
                    server_header = response.headers.get('Server', '')
                    if 'Microsoft-IIS' in server_header or 'Exchange' in response.text:
                        exchange_issues.append({
                            'platform': 'Microsoft Exchange',
                            'vulnerability': 'OWA Exposed',
                            'url': url,
                            'risk_level': 'HIGH',
                            'description': f'Ø®Ø¯Ù…Ø© OWA Ù…ÙƒØ´ÙˆÙØ©: {url}'
                        })
            except:
                pass
        
        # ÙØ­Øµ Ø«ØºØ±Ø§Øª Exchange Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©
        vulnerability_checks = [
            {
                'name': 'ProxyLogon',
                'path': '/ecp/pentest.js',
                'pattern': 'X-BEResource'
            },
            {
                'name': 'ProxyShell',
                'path': '/autodiscover/autodiscover.json',
                'pattern': 'powershell'
            }
        ]
        
        for check in vulnerability_checks:
            try:
                url = f"https://{target}{check['path']}"
                response = self.session.get(url, timeout=15, verify=False)
                if response.status_code != 404:
                    exchange_issues.append({
                        'platform': 'Microsoft Exchange',
                        'vulnerability': check['name'],
                        'url': url,
                        'risk_level': 'CRITICAL',
                        'description': f'Ø«ØºØ±Ø© {check["name"]} Ù…Ø­ØªÙ…Ù„Ø© ÙÙŠ Exchange'
                    })
            except:
                pass
                
        return exchange_issues

    def scan_cloud_servers(self, target):
        """ÙØ­Øµ Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©"""
        print("ğŸ” ÙØ­Øµ Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ø­ÙˆØ³Ø¨Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©...")
        cloud_issues = []
        
        # ÙØ­Øµ AWS EC2
        aws_patterns = [
            f"ec2-{target.replace('.', '-')}.compute-1.amazonaws.com",
            f"ec2-{target.replace('.', '-')}.us-east-1.compute.amazonaws.com"
        ]
        
        # ÙØ­Øµ Azure VMs
        azure_patterns = [
            f"{target}.cloudapp.net",
            f"{target}.azurewebsites.net",
            f"{target}.trafficmanager.net"
        ]
        
        # ÙØ­Øµ Google Cloud
        gcp_patterns = [
            f"{target}.c.INTERNAL_PROJECT_ID.internal",
            f"{target}.googleusercontent.com"
        ]
        
        all_patterns = aws_patterns + azure_patterns + gcp_patterns
        
        for hostname in all_patterns:
            try:
                socket.gethostbyname(hostname)
                cloud_issues.append({
                    'platform': 'Cloud Server',
                    'vulnerability': 'Exposed Instance',
                    'hostname': hostname,
                    'risk_level': 'MEDIUM',
                    'description': f'Ø®Ø§Ø¯Ù… Ø³Ø­Ø§Ø¨ÙŠ Ù…ÙƒØ´ÙˆÙ: {hostname}'
                })
            except:
                pass
        
        return cloud_issues

    def scan_framework_vulnerabilities(self, target):
        """ÙØ­Øµ Ø£Ø·Ø± Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ù†ØªØ´Ø±Ø©"""
        print("ğŸ” ÙØ­Øµ Ø£Ø·Ø± Ø§Ù„Ø¹Ù…Ù„...")
        framework_issues = []
        
        # ÙØ­Øµ WordPress
        wp_checks = [
            '/wp-admin/',
            '/wp-login.php',
            '/xmlrpc.php',
            '/wp-content/',
            '/wp-includes/'
        ]
        
        for path in wp_checks:
            try:
                url = f"https://{target}{path}"
                response = self.session.get(url, timeout=10, verify=False)
                if response.status_code == 200:
                    if 'wordpress' in response.text.lower() or 'wp-' in response.text.lower():
                        framework_issues.append({
                            'platform': 'WordPress',
                            'vulnerability': 'WordPress Exposed',
                            'url': url,
                            'risk_level': 'MEDIUM',
                            'description': f'WordPress Ù…ÙƒØ´ÙˆÙ: {url}'
                        })
            except:
                pass
        
        # ÙØ­Øµ Drupal
        drupal_checks = [
            '/user/login',
            '/admin',
            '/node',
            '/sites/default/files/'
        ]
        
        for path in drupal_checks:
            try:
                url = f"https://{target}{path}"
                response = self.session.get(url, timeout=10, verify=False)
                if response.status_code == 200:
                    if 'drupal' in response.text.lower():
                        framework_issues.append({
                            'platform': 'Drupal',
                            'vulnerability': 'Drupal Exposed',
                            'url': url,
                            'risk_level': 'MEDIUM',
                            'description': f'Drupal Ù…ÙƒØ´ÙˆÙ: {url}'
                        })
            except:
                pass
        
        # ÙØ­Øµ Laravel
        laravel_checks = [
            '/.env',
            '/storage/logs/',
            '/vendor/',
            '/.git/'
        ]
        
        for path in laravel_checks:
            try:
                url = f"https://{target}{path}"
                response = self.session.get(url, timeout=10, verify=False)
                if response.status_code == 200:
                    if path == '/.env' and 'APP_KEY' in response.text:
                        framework_issues.append({
                            'platform': 'Laravel',
                            'vulnerability': 'Env File Exposed',
                            'url': url,
                            'risk_level': 'CRITICAL',
                            'description': f'Ù…Ù„Ù .env Laravel Ù…ÙƒØ´ÙˆÙ: {url}'
                        })
                    elif path == '/.git/' and 'refs' in response.text:
                        framework_issues.append({
                            'platform': 'Git',
                            'vulnerability': 'Git Repository Exposed',
                            'url': url,
                            'risk_level': 'HIGH',
                            'description': f'Ù…Ø³ØªÙˆØ¯Ø¹ Git Ù…ÙƒØ´ÙˆÙ: {url}'
                        })
            except:
                pass
        
        return framework_issues

    def scan_jenkins_vulnerabilities(self, target):
        """ÙØ­Øµ Ø«ØºØ±Ø§Øª Jenkins"""
        print("ğŸ” ÙØ­Øµ Ø«ØºØ±Ø§Øª Jenkins...")
        jenkins_issues = []
        
        jenkins_urls = [
            f"http://{target}:8080",
            f"https://{target}:8443",
            f"http://{target}:8080/jenkins",
            f"https://{target}/jenkins"
        ]
        
        for url in jenkins_urls:
            try:
                response = self.session.get(url, timeout=10, verify=False)
                if response.status_code == 200:
                    if 'jenkins' in response.text.lower() or 'hudson' in response.text.lower():
                        # ÙØ­Øµ Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ø¯ÙˆÙ† Ù…ØµØ§Ø¯Ù‚Ø©
                        api_url = f"{url}/api/json"
                        try:
                            api_response = self.session.get(api_url, timeout=10, verify=False)
                            if api_response.status_code == 200:
                                jenkins_issues.append({
                                    'platform': 'Jenkins',
                                    'vulnerability': 'Unauthenticated Access',
                                    'url': api_url,
                                    'risk_level': 'HIGH',
                                    'description': f'Jenkins Ù…ØªØ§Ø­ Ø¨Ø¯ÙˆÙ† Ù…ØµØ§Ø¯Ù‚Ø©: {url}'
                                })
                        except:
                            pass
            except:
                pass
        
        return jenkins_issues

    def scan_database_exposure(self, target):
        """ÙØ­Øµ ØªØ¹Ø±Ø¶ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"""
        print("ğŸ” ÙØ­Øµ ØªØ¹Ø±Ø¶ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...")
        db_issues = []
        
        # Ù…Ù†Ø§ÙØ° Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
        db_ports = {
            3306: 'MySQL',
            5432: 'PostgreSQL',
            1433: 'MSSQL',
            27017: 'MongoDB',
            6379: 'Redis',
            9200: 'Elasticsearch',
            11211: 'Memcached',
            1521: 'Oracle',
            5000: 'SQLite'
        }
        
        for port, service in db_ports.items():
            try:
                sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                sock.settimeout(3)
                result = sock.connect_ex((target, port))
                sock.close()
                
                if result == 0:
                    db_issues.append({
                        'platform': service,
                        'vulnerability': 'Database Exposed',
                        'port': port,
                        'risk_level': 'CRITICAL',
                        'description': f'Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª {service} Ù…ÙƒØ´ÙˆÙØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° {port}'
                    })
            except:
                pass
        
        return db_issues

    def generate_report(self, all_vulnerabilities, target):
        """Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„"""
        print("\nğŸ“Š ØªÙ‚Ø±ÙŠØ± ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø§Øª")
        print("=" * 60)
        
        if not all_vulnerabilities:
            print("âœ… Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø«ØºØ±Ø§Øª")
            return
        
        # ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø®Ø§Ø·Ø±
        critical = [v for v in all_vulnerabilities if v['risk_level'] == 'CRITICAL']
        high = [v for v in all_vulnerabilities if v['risk_level'] == 'HIGH']
        medium = [v for v in all_vulnerabilities if v['risk_level'] == 'MEDIUM']
        low = [v for v in all_vulnerabilities if v['risk_level'] == 'LOW']
        
        print(f"ğŸš¨ Ø«ØºØ±Ø§Øª Ø­Ø±Ø¬Ø©: {len(critical)}")
        print(f"ğŸ”´ Ø«ØºØ±Ø§Øª Ø¹Ø§Ù„ÙŠØ©: {len(high)}")
        print(f"âš ï¸  Ø«ØºØ±Ø§Øª Ù…ØªÙˆØ³Ø·Ø©: {len(medium)}")
        print(f"â„¹ï¸  Ø«ØºØ±Ø§Øª Ù…Ù†Ø®ÙØ¶Ø©: {len(low)}")
        print()
        
        # Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        for vuln in all_vulnerabilities:
            print(f"[{vuln['risk_level']}] {vuln['platform']}: {vuln['description']}")
        
        # Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        report = {
            'target': target,
            'scan_date': datetime.now().isoformat(),
            'total_vulnerabilities': len(all_vulnerabilities),
            'critical': len(critical),
            'high': len(high),
            'medium': len(medium),
            'low': len(low),
            'vulnerabilities': all_vulnerabilities
        }
        
        filename = f"platform_vulnerabilities_{target}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(report, f, ensure_ascii=False, indent=2)
        
        print(f"\nğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ: {filename}")

    def run_platform_scan(self, target):
        """ØªØ´ØºÙŠÙ„ ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ù†ØµØ§Øª"""
        self.banner()
        
        print(f"ğŸ¯ Ø¨Ø¯Ø¡ ÙØ­Øµ Ø«ØºØ±Ø§Øª Ø§Ù„Ù…Ù†ØµØ§Øª: {target}")
        print("=" * 60)
        
        all_vulnerabilities = []
        
        # ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙØ­Øµ
        scanners = [
            self.scan_zoom_vulnerabilities,
            self.scan_exchange_vulnerabilities,
            self.scan_cloud_servers,
            self.scan_framework_vulnerabilities,
            self.scan_jenkins_vulnerabilities,
            self.scan_database_exposure
        ]
        
        for scanner in scanners:
            try:
                vulnerabilities = scanner(target)
                all_vulnerabilities.extend(vulnerabilities)
            except Exception as e:
                print(f"âš ï¸ Ø®Ø·Ø£ ÙÙŠ {scanner.__name__}: {str(e)}")
        
        self.generate_report(all_vulnerabilities, target)
        return all_vulnerabilities

def main():
    parser = argparse.ArgumentParser(description='Ø£Ø¯Ø§Ø© ÙØ­Øµ Ø«ØºØ±Ø§Øª Ø§Ù„Ù…Ù†ØµØ§Øª ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ù‡ÙŠØ±Ø©')
    parser.add_argument('-t', '--target', required=True, help='Ø§Ù„Ù‡Ø¯Ù Ù„Ù„ÙØ­Øµ (Ù†Ø·Ø§Ù‚ Ø£Ùˆ IP)')
    parser.add_argument('-o', '--output', help='Ù…Ù„Ù Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ JSON')
    
    args = parser.parse_args()
    
    scanner = PlatformVulnerabilityScanner()
    vulnerabilities = scanner.run_platform_scan(args.target)

if __name__ == "__main__":
    main()